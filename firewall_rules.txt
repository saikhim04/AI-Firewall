# Generated by iptables-save v1.8.10 (nf_tables) on Tue Aug 19 15:10:12 2025
*filter
:INPUT ACCEPT [25018:29416313]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]

# 1) allow loopback
-A INPUT -i lo -j ACCEPT

# 2) drop แพ็กเก็ตผิดปกติ
-A INPUT -m conntrack --ctstate INVALID -j DROP

# 3) allow ESTABLISHED,RELATED (stateful)
-A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT

# 4) SSH (พร้อม rate-limit กัน brute force)
-A INPUT -p tcp --dport 22 -m state --state NEW -m recent --set --name SSH
-A INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 30 --name SSH -j DROP
-A INPUT -p tcp --dport 22 -j ACCEPT
# (ถ้ามี IP ผู้ดูแลแน่นอน แนะนำจำกัดต้นทางด้วย: -s <TRUSTED_CIDR>)

# 5) Web
-A INPUT -p tcp --dport 80  -j ACCEPT
-A INPUT -p tcp --dport 443 -j ACCEPT

# 6) DNS (เปิดเฉพาะถ้าเครื่องนี้เป็น DNS server)
# -A INPUT -p udp --dport 53 -j ACCEPT
# -A INPUT -p tcp --dport 53 -j ACCEPT  # สำหรับกรณีตอบกลับใหญ่/AXFR

# 7) ICMP (ping) เฉพาะวินิจฉัยเครือข่าย
-A INPUT -p icmp -j ACCEPT

-A INPUT -p tcp --dport 23   -j DROP   # Telnet
-A INPUT -p tcp --dport 21   -j DROP   # FTP (plaintext)
-A INPUT -p tcp --dport 445  -j DROP   # SMB
-A INPUT -p tcp --dport 3389 -j DROP   # RDP

# 9) (ออปชัน) log ก่อนทิ้งแบบจำกัดความถี่
# -A INPUT -m limit --limit 5/min -j LOG --log-prefix "FW_DROP " --log-level 4

COMMIT
# Completed on Tue Aug 19 15:10:12 2025
